// For format details, see https://aka.ms/devcontainer.json. For config options, see the
// README at: https://github.com/devcontainers/templates/tree/main/src/docker-in-docker
{
	"name": "ionos-wordpress-devcontainer",
	// Or use a Dockerfile or Docker Compose file. More info: https://containers.dev/guide/dockerfile
  "build": {
      // Path is relative to the devcontainer.json file.
      "dockerfile": "Dockerfile"
  },

	"features": {
		"ghcr.io/devcontainers/features/docker-in-docker:2": {
			"moby": false,
			"installDockerBuildx": true,
			"version": "latest",
			"dockerDashComposeVersion": "latest"
		}
	},

  // doesnt work anymore as of 2024-10-29
  // // Dev container build failed: Legacy feature 'mounts' not supported. Please check https://containers.dev/features for replacements
  // //
  // // enable persisted bash completion
  // // https://code.visualstudio.com/remote/advancedcontainers/persist-bash-history
  // "mounts": [
  //   "source=projectname-bashhistory,target=/commandhistory,type=volume"
  // ],

  "portsAttributes": {
		"9003": {
			"label": "PHP xdebug port"
		},
		"8888": {
			"label": "wp-env developer instance"
		},
		"8889": {
			"label": "wp-env test instance"
		},
		"6006": {
			"label": "storybook dev server"
		}
	},

  "appPort": [
    8888,
    8889,
    9003,
    6006
  ],

  "postStartCommand": "pnpm env use --global $PNPM_NODEJS_VERSION; pnpm config set store-dir ~/.pnpm-store"
}
